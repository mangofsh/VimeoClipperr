<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Business Intake Form</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f6f8;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 700px;
      margin: 40px auto;
      background-color: #ffffff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: #333;
    }
    form {
      display: flex;
      flex-direction: column;
    }
    label {
      margin-top: 15px;
      font-weight: bold;
      color: #444;
    }
    input[type="text"],
    textarea {
      margin-top: 5px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      background-color: #fafafa;
    }
    textarea {
      resize: vertical;
    }
    button[type="submit"] {
      margin-top: 25px;
      padding: 12px;
      background-color: #0077cc;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button[type="submit"]:hover {
      background-color: #005fa3;
    }
    #results-container {
      margin-top: 30px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .result {
      background-color: #e9ecef;
      padding: 15px;
      border-radius: 6px;
    }
    .result h2, .result h3 {
      margin-top: 1rem;
    }
  </style>
  <!-- ✅ Add Marked.js Markdown Parser -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>Business Intake Form</h1>
    <form id="business-intake-form">
      <label for="individualName">Your Name:</label>
      <input type="text" id="individualName" name="individualName" required />

      <label for="businessName">Business Name:</label>
      <input type="text" id="businessName" name="businessName" required />

      <label for="profession">Profession:</label>
      <input type="text" id="profession" name="profession" required />

      <label for="placeOfWork">Place of Work:</label>
      <input type="text" id="placeOfWork" name="placeOfWork" required />

      <label for="workIssues">Issues at Work (e.g., need staff, overworked, need more revenue/activity, just starting out):</label>
      <textarea id="workIssues" name="workIssues" rows="4" required></textarea>

      <label for="serviceNeeds">Services Needed:</label>
      <textarea id="serviceNeeds" name="serviceNeeds" rows="4" required></textarea>

      <button type="submit">Submit</button>
    </form>

    <div id="results-container" class="result"></div>
  </div>

  <script>
    document.getElementById('business-intake-form').addEventListener('submit', async function(e) {
      e.preventDefault();

      const form = e.target;
      const formData = new FormData(form);
      const formJSON = {};
      formData.forEach((value, key) => {
        formJSON[key] = value.trim();
      });

      const startupProfiles = [
        {
          name: "XoomMD",
          coreServices: [
            "Website Design and Development",
            "SEO and Local SEO",
            "Content Marketing",
            "PPC Management",
            "Social Media Engagement",
            "Email Campaigns",
            "Video Content Creation"
          ],
          sector: "Healthcare Marketing",
          targetClients: ["Clinics", "Doctors", "Private Practices"],
          summary: "XoomMD helps medical practices attract more patients by providing end-to-end web presence, SEO, social media, and ad campaigns."
        }
      ];

      const prompt = `
      You are a business matchmaking assistant. Given a business owner's intake form and a list of startup service providers (profiles), identify the startup that best aligns with their needs. Address the user directly and break down how the suggestion addresses all of the business owner's challenges and needs. Walk them through how this will improve thier circumstances. Address them directly. Use bold, formatting and other ways to make your responses readable.

      ### Business Owner Info:
      - Name: ${formJSON.individualName}
      - Business: ${formJSON.businessName}
      - Profession: ${formJSON.profession}
      - Work Location: ${formJSON.placeOfWork}
      - Challenges: ${formJSON.workIssues}
      - Needs: ${formJSON.serviceNeeds}

      ### Startup Profiles:
      ${JSON.stringify(startupProfiles, null, 2)}

      Respond in this format:

      **Recommendation:** I recommend [Startup Name] because it specializes in [reasons related to services + how they solve the business owner’s challenges].

      Only include startups that clearly match based on services or industry.
      `;


      try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer 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' // ✅ Replace with your API key
          },
          body: JSON.stringify({
            model: 'gpt-4o',
            messages: [
              { role: 'system', content: 'You are a helpful assistant that provides service recommendations based on business intake forms.' },
              { role: 'user', content: prompt }
            ],
            temperature: 0.7
          })
        });

        if (!response.ok) {
          throw new Error(`OpenAI API error: ${response.statusText}`);
        }

        const data = await response.json();
        const result = data.choices[0].message.content;
        console.log("GPT-4o Response:", result);

        // Render markdown to HTML
        const container = document.getElementById("results-container");
        container.innerHTML = marked.parse(result);

      } catch (error) {
        console.error("Error:", error);
        alert("⚠️ An error occurred while processing your request. Please try again later.");
      }
    });
  </script>
</body>
</html>
