<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Business Intake Form</title>

  <!-- Tailwind + Marked -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#10b981'
          },
          fontFamily: {
            mono: ['Fira Code', 'monospace']
          }
        }
      }
    };
  </script>
  <link href="https://cdn.jsdelivr.net/npm/@tailwindcss/typography@0.5.9/dist/typography.min.css" rel="stylesheet" />

  <style>
    .prose {
      color: #e2e8f0;
      max-width: none;
    }
    .prose h1, .prose h2, .prose h3 {
      color: white;
      margin-top: 1.5em;
      margin-bottom: 0.8em;
      font-weight: 600;
    }
    .prose h1 { font-size: 1.875rem; line-height: 2.25rem; }
    .prose h2 { font-size: 1.5rem; line-height: 2rem; }
    .prose h3 { font-size: 1.25rem; line-height: 1.75rem; color: #f0f9ff; }
    .prose p { margin-top: 0.75em; margin-bottom: 0.75em; }
    .prose strong { color: #f0f9ff; font-weight: 600; }
    .prose mark {
      background-color: #22c55e33;
      color: #bbf7d0;
      padding: 0 0.2em;
      border-radius: 0.25rem;
    }
    .prose ul {
      list-style-type: disc;
      padding-left: 1.625em;
    }
    .prose li {
      margin-top: 0.25em;
      margin-bottom: 0.25em;
    }
    .profile-section {
      border-bottom: 1px solid #4b5563;
      padding-bottom: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .profile-section:last-child {
      border-bottom: none;
    }
  </style>
</head>

<body class="dark bg-gray-900 text-white min-h-screen overflow-x-hidden">
  <div class="max-w-2xl mx-auto mt-10 bg-gray-800 rounded-lg shadow-xl p-8 relative z-10">
    <h1 class="text-2xl font-bold mb-6 text-center text-white">üì• Business Intake Form</h1>

    <form id="business-intake-form" class="space-y-5">
      <div>
        <label for="individualName" class="block font-medium text-gray-300">Your Name:</label>
        <input type="text" id="individualName" name="individualName" required
               class="w-full p-3 rounded bg-gray-900 text-white border border-gray-600 placeholder-gray-500"
               placeholder="e.g. Dr. Green Smith" />
      </div>

      <div>
        <label for="businessName" class="block font-medium text-gray-300">Business Name:</label>
        <input type="text" id="businessName" name="businessName" required
               class="w-full p-3 rounded bg-gray-900 text-white border border-gray-600 placeholder-gray-500"
               placeholder="e.g. Green Medical Clinic" />
      </div>

      <div>
        <label for="profession" class="block font-medium text-gray-300">Profession:</label>
        <input type="text" id="profession" name="profession" required
               class="w-full p-3 rounded bg-gray-900 text-white border border-gray-600 placeholder-gray-500"
               placeholder="e.g. Neurologist, Dentist, Private Practice Owner" />
      </div>

      <div>
        <label for="placeOfWork" class="block font-medium text-gray-300">Place of Work:</label>
        <input type="text" id="placeOfWork" name="placeOfWork" required
               class="w-full p-3 rounded bg-gray-900 text-white border border-gray-600 placeholder-gray-500"
               placeholder="e.g. Dallas TX, Princeton NJ, Remote" />
      </div>

      <div>
        <label for="workIssues" class="block font-medium text-gray-300">Issues at Work:</label>
        <textarea id="workIssues" name="workIssues" rows="3" required
                  class="w-full p-3 rounded bg-gray-900 text-white border border-gray-600 placeholder-gray-500"
                  placeholder="Examples: Need more patients, overworked, can't scale, unsure about marketing, just starting out..."></textarea>
      </div>

      <div>
        <label for="serviceNeeds" class="block font-medium text-gray-300">Services Needed:</label>
        <textarea id="serviceNeeds" name="serviceNeeds" rows="3" required
                  class="w-full p-3 rounded bg-gray-900 text-white border border-gray-600 placeholder-gray-500"
                  placeholder="Examples: SEO, social media management, brand strategy, appointment automation, new website..."></textarea>
      </div>

      <button type="submit" class="bg-primary text-white px-6 py-3 rounded hover:bg-emerald-600 transition">Submit</button>
    </form>
  </div>

  <!-- Slide-in Results Panel -->
  <div id="results-panel"
       class="fixed top-0 right-0 h-full w-full sm:w-[560px] bg-gray-800 shadow-xl transform translate-x-full transition-transform duration-500 ease-in-out z-40 overflow-y-auto">
    <div class="p-6 border-b border-gray-700 flex justify-between items-center">
      <h2 class="text-lg font-semibold text-white">üß† Recommendation</h2>
      <button onclick="closePanel()" class="text-gray-400 hover:text-white text-xl">&times;</button>
    </div>
    <div id="resultContent" class="p-6 prose prose-invert"></div>
  </div>

  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="fixed inset-0 bg-gray-900 bg-opacity-80 hidden flex items-center justify-center z-50">
    <div class="text-center">
      <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-emerald-500 border-opacity-75 mx-auto mb-4"></div>
      <p class="text-white text-lg font-medium">Loading...</p>
    </div>
  </div>

  <script>
    function renderMarkdown(mdText) {
      marked.setOptions({ gfm: true, breaks: true, headerIds: false });

      const parsedContent = marked.parse(mdText || "");
      const processedContent = parsedContent
        .replace(/<h2/g, '<div class="profile-section"><h2')
        .replace(/<h2/g, '<h2 class="text-xl font-bold mt-6 mb-3 text-white"')
        .replace(/<\/h2>/g, '</h2>')
        .replace(/<\/div><div class="profile-section">/g, '</div><div class="profile-section">') + '</div>';

      return `<div class="prose prose-invert">${processedContent}</div>`;
    }

    function closePanel() {
      document.getElementById("results-panel").classList.add("translate-x-full");
    }

    function openPanel() {
      document.getElementById("results-panel").classList.remove("translate-x-full");
    }

    document.getElementById('business-intake-form').addEventListener('submit', async function(e) {
      e.preventDefault();

      const form = e.target;
      const formData = new FormData(form);
      const formJSON = {};
      formData.forEach((value, key) => { formJSON[key] = value.trim(); });

      const startupProfiles = [
        {
          name: "XoomMD",
          coreServices: ["Website Design", "SEO", "Content", "Social Media", "Video Creation"],
          sector: "Healthcare Marketing",
          summary: "XoomMD helps medical practices attract more patients through web, SEO, and content strategies."
        }
      ];

      const prompt = `
You are a business matchmaking assistant. Based on this intake form and startup profile, recommend the best fit and explain why.

### Business Info:
- Name: ${formJSON.individualName}
- Business: ${formJSON.businessName}
- Profession: ${formJSON.profession}
- Work Location: ${formJSON.placeOfWork}
- Challenges: ${formJSON.workIssues}
- Needs: ${formJSON.serviceNeeds}

### Startup Profile:
${JSON.stringify(startupProfiles, null, 2)}

Respond in bold, readable formatting with clear structure.
start with a greeting and then provide the recommendation. Use headings, bullet points, and highlights to make it easy to read.
`;

      const overlay = document.getElementById("loadingOverlay");
      const content = document.getElementById("resultContent");

      overlay.classList.remove("hidden");
      content.innerHTML = "";

      try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer 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'
          },
          body: JSON.stringify({
            model: 'gpt-4o',
            messages: [
              { role: 'system', content: 'You are a helpful assistant that provides service recommendations based on business intake forms. Address the subject directly not in third person! Greet them and be informative to them.' },
              { role: 'user', content: prompt }
            ],
            temperature: 0.7
          })
        });

        if (!response.ok) throw new Error(`OpenAI error: ${response.statusText}`);
        const data = await response.json();
        content.innerHTML = renderMarkdown(data.choices[0].message.content);
        openPanel();
      } catch (err) {
        content.innerHTML = `<p class="text-red-400">‚ùó ${err.message}</p>`;
        openPanel();
      } finally {
        overlay.classList.add("hidden");
      }
    });
  </script>
</body>
</html>
