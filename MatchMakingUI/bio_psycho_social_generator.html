<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bio-Psycho-Social Profile Builder</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 800px;
      margin: 2rem auto;
      background: #ffffff;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
    }
    h2 { margin-top: 1.5rem; color: #2c3e50; }
    textarea {
      width: 100%;
      min-height: 120px;
      margin-top: 0.5rem;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
    }
    input[type="text"] {
      padding: 10px;
      width: 100%;
      margin-bottom: 1rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    #generatedOutput {
      background: #f4f6f8;
      padding: 1.5rem;
      margin-top: 1rem;
      border-radius: 6px;
      white-space: pre-wrap;
    }
    #generatedOutput,
    #editControls {
      margin-bottom: 1rem;
    }

    #editControls {
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end; /* optional, you can set to center or start */
    }

    .button {
      background: #0077cc;
      color: white;
      padding: 10px 15px;
      margin-top: 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .button:hover {
      background: #005fa3;
    }
    #statusMessage {
      margin-top: 1rem;
      font-weight: 500;
      color: #333;
    }
    .hidden {
      display: none !important;
    }
    #editControls {
      margin-top: 1rem;
    }
    #editArea {
      width: 100%;
      height: 300px;
      margin-top: 1rem;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      font-family: monospace;
    }
    #loadingOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    #loadingOverlay.hidden {
      display: none !important;
    }
    .loader {
      border: 8px solid #f3f3f3;
      border-top: 8px solid #0077cc;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß† Bio-Psycho-Social Business Profile Builder</h1>
    <label for="profileCode">Assign or Retrieve Profile Code (e.g., ya214):</label>
    <input type="text" id="profileCode" placeholder="Enter profile code" />
    <button class="button" onclick="checkProfile()">Continue</button>
    <p id="statusMessage"></p>
    <div id="profileSection" class="hidden">
      <div id="generatedOutput"></div>
      <div id="editControls" class="hidden">
        <button class="button" onclick="enterEditMode()">Edit</button>
        <button class="button hidden" onclick="saveEdits()">Save Changes</button>
      </div>
      <div id="initialButtonContainer">
        <button class="button" onclick="generateInitial()">Generate Initial Profile</button>
      </div>
      <div id="enrichmentSection" class="hidden">
        <h2>üìù Enrichment Notes</h2>
        <textarea id="userEnrichment" placeholder="Add enrichment here..."></textarea>
        <button class="button" onclick="generateEnhanced()">Regenerate with Enrichment</button>
      </div>
    </div>
  </div>

  <div id="loadingOverlay" class="hidden">
    <div class="loader"></div>
  </div>

  <script>
    const intakeData = {
      individualName: "Dr. Ayaan Malik",
      businessName: "NeuroFocus Clinics",
      profession: "Neurologist and Private Practice Owner",
      placeOfWork: "Dallas, TX",
      workIssues: "Wants to attract more patients online and automate appointment scheduling",
      serviceNeeds: "Marketing, web design, CRM tools"
    };

    const mockDatabase = {
      ya214: `
## Bio
**Name:** Dr. Yusef Alimam  
**Profession:** Medical AI Strategist, CTO, Educator  
**Business Name:** Green Medical Network Group  
**Place of Work:** Global / Remote  

## Psycho
Dr. Yusef Alimam is driven by a deep belief in using AI to solve meaningful problems in healthcare and education. With dual strengths in biomedical science and artificial intelligence, he thrives at the intersection of innovation and impact. His inner motivation stems from the desire to build systems that are not just efficient, but ethical ‚Äî aiming to reduce friction in care delivery and elevate clinical intelligence. He is intellectually curious, systems-oriented, and constantly learning to refine both himself and the tools he builds.

## Social
Dr. Alimam is embedded in a highly interdisciplinary and international network ‚Äî with active ties in San Diego, Bahrain, Dallas, and multiple global innovation hubs. His social presence spans startups, faith-based initiatives, academic ecosystems, and high-performing medical networks. He is known as a thoughtful collaborator, an educator-mentor, and a connector between technical and clinical worlds.

## Business Needs
- **AI Automation for Healthcare:** Building or partnering with tools that use LLMs and computer vision to improve workflows in radiology, memory clinics, and administrative processes.  
- **Strategic Partnerships:** Identifying early-stage ventures that align with ethical medical AI.  
- **Scalable Revenue Streams:** Designing platforms or licensing models for white-labeled AI infrastructure (e.g., Muse for eyewear, RLA for supply chains).  
- **Networked Intelligence:** Integrating data from hundreds of physicians into shared knowledge systems and patient-enabling interfaces.  
- **Delegation & Offshore Teams:** Efficiently managing vetted remote contributors in design, engineering, and content ops.

## Income
**Income:** $120K/year

## Opportunities
**Opportunities:** Can organize business relationships with hungry doctors to help them build their own AI tools. Interested in investing in early-stage biotech in Europe.

`
    };

    let currentProfileMarkdown = null;
    let currentProfileCode = null;
    let isEditing = false;

    function checkProfile() {
      const code = document.getElementById("profileCode").value.trim();
      if (!code) return alert("Enter a profile code.");

      currentProfileCode = code;
      document.getElementById("profileSection").classList.remove("hidden");

      if (mockDatabase[code]) {
        currentProfileMarkdown = mockDatabase[code];
        renderMarkdown(currentProfileMarkdown);
        document.getElementById("initialButtonContainer").classList.add("hidden");
        document.getElementById("enrichmentSection").classList.remove("hidden");
        document.getElementById("editControls").classList.remove("hidden");
        document.getElementById("statusMessage").innerText = `‚úÖ User found: Loaded profile for ${code}`;
      } else {
        document.getElementById("initialButtonContainer").classList.remove("hidden");
        document.getElementById("enrichmentSection").classList.add("hidden");
        document.getElementById("editControls").classList.add("hidden");
        document.getElementById("statusMessage").innerText = `üÜï Creating new user profile for ${code}`;
      }
    }

    async function generateInitial() {
      document.getElementById("statusMessage").innerText = "‚è≥ Generating initial profile...";
      document.getElementById("loadingOverlay").classList.remove("hidden");

      const prompt = `
You are a profile generation assistant. Use the following intake data to generate a **Bio-Psycho-Social-BusinessNeeds** profile. Include placeholders for **Income** and **Opportunities** as 'INPUT HERE'. Do not suggest any startups.

Respond in markdown format with the following sections:
- Bio
- Psycho
- Social
- Business Needs
- Income
- Opportunities

### Intake:
${JSON.stringify(intakeData, null, 2)}
`.trim();

      const content = await fetchFromOpenAI(prompt);
      currentProfileMarkdown = content;
      renderMarkdown(content);
      document.getElementById("initialButtonContainer").classList.add("hidden");
      document.getElementById("enrichmentSection").classList.remove("hidden");
      document.getElementById("editControls").classList.remove("hidden");
      document.getElementById("loadingOverlay").classList.add("hidden");
      document.getElementById("statusMessage").innerText = `‚úÖ Initial profile created for ${currentProfileCode}`;
    }

    async function generateEnhanced() {
      if (isEditing) {
        const save = confirm("You have unsaved changes. Save before continuing?");
        if (save) saveEdits(); else return;
      }

      document.getElementById("statusMessage").innerText = "‚è≥ Enriching profile...";
      document.getElementById("loadingOverlay").classList.remove("hidden");

      const notes = document.getElementById("userEnrichment").value;
      const prompt = `
You are a profile enrichment assistant. Merge this markdown profile with analyst enrichment.

‚úÖ Use exactly these sections:
## Bio  
## Psycho  
## Social  
## Business Needs  
## Income  
## Opportunities

Only output valid markdown with these sections. No extra commentary.

### Current Profile:
${currentProfileMarkdown}

### Analyst Enrichment:
${notes}
`.trim();

      const content = await fetchFromOpenAI(prompt);
      currentProfileMarkdown = content;
      renderMarkdown(content);
      document.getElementById("userEnrichment").value = "";
      document.getElementById("loadingOverlay").classList.add("hidden");
      document.getElementById("statusMessage").innerText = "‚úÖ Profile updated.";
    }

    function enterEditMode() {
      if (isEditing) return;
      isEditing = true;

      document.getElementById("generatedOutput").classList.add("hidden");
      const area = document.createElement("textarea");
      area.id = "editArea";
      area.value = currentProfileMarkdown;
      document.getElementById("editControls").before(area);

      document.querySelector("#editControls button[onclick='enterEditMode()']").classList.add("hidden");
      document.querySelector("#editControls button[onclick='saveEdits()']").classList.remove("hidden");
    }

    function saveEdits() {
      const area = document.getElementById("editArea");
      if (!area) return;
      currentProfileMarkdown = area.value;
      area.remove();
      isEditing = false;
      renderMarkdown(currentProfileMarkdown);

      document.getElementById("generatedOutput").classList.remove("hidden");
      document.querySelector("#editControls button[onclick='enterEditMode()']").classList.remove("hidden");
      document.querySelector("#editControls button[onclick='saveEdits()']").classList.add("hidden");
    }

    function renderMarkdown(mdText) {
      const code = document.getElementById("profileCode").value.trim();
      const header = code ? `<h2>üÜî Profile: ${code}</h2>` : "";
      const highlighted = mdText.replace(/INPUT HERE/g, '<mark>INPUT HERE</mark>');
      document.getElementById("generatedOutput").innerHTML = header + marked.parse(highlighted);
    }

    async function fetchFromOpenAI(promptText) {
      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer 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"
        },
        body: JSON.stringify({
          model: "gpt-4o",
          messages: [
            { role: "system", content: "You are a profile generation assistant." },
            { role: "user", content: promptText }
          ],
          temperature: 0.7
        })
      });
      const data = await response.json();
      return data.choices?.[0]?.message?.content || "‚ö†Ô∏è No response from GPT.";
    }

    window.addEventListener("load", () => {
      document.getElementById("loadingOverlay").classList.add("hidden");
    });

  </script>
</body>
</html>